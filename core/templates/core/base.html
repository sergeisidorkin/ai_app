{% load static %}
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="app-id" content="ai_app"><!-- для smoke-теста -->
    <title>{% block title %}AI App{% endblock %}</title>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <!-- Bootstrap 5 (CSS) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <!-- ваши глобальные стили -->
    <link rel="stylesheet" href="{% static 'core/css/site.css' %}">

  </head>
  <body class="bg-light m-0">
    {% include "core/_nav.html" %}

    <main class="p-0 m-0" id="app" data-testid="app-root">
      {% if messages %}
        <div class="mb-3">
          {% for m in messages %}
            <div class="alert alert-{{ m.tags|default:'info' }} mb-2">{{ m }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <!-- Bootstrap 5 (JS bundle: включает Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
          // Переключатель сворачивания сайдбара
          document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('sidebarToggle');
            if (sidebar && toggle) {
              toggle.addEventListener('click', function (e) {
                e.preventDefault();
                sidebar.classList.toggle('is-collapsed');
                // Поворот иконки
                const icon = toggle.querySelector('[data-chevron]');
                if (icon) {
                  icon.classList.toggle('rotate-180');
                }
              });
            }
          });
        </script>

        <script>
            (function () {
              function getCookie(name) {
                const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
                return m ? m.pop() : '';
              }
              document.addEventListener('htmx:configRequest', function (e) {
                const token = getCookie('csrftoken');
                if (token) {
                  e.detail.headers['X-CSRFToken'] = token;
                }
              });
            })();
        </script>

        <!-- Подключение статических модулей для таблиц политики -->
        {% load static %}
        <script defer src="{% static 'core/js/selectable-tables.js' %}"></script>
        <script defer src="{% static 'core/js/policy-panels.js' %}"></script>

  </body>
</html>
