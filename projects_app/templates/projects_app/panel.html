{% load static %}
<div class="card shadow-sm">
  <div class="card-body">
    <div id="projects-pane"
         hx-get="{% url 'projects_partial' %}"
         hx-trigger="load"
         hx-target="#projects-pane"
         hx-swap="innerHTML"
         hx-indicator="#projects-loading">
      <div id="projects-loading" class="text-muted htmx-indicator">Загрузка проектов…</div>
    </div>

    <!-- Постоянная модалка -->
    <div class="modal fade" id="projects-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content"></div>
      </div>
    </div>




<div class="d-flex justify-content-between align-items-center mb-3 table-section-header" style="margin-top: 50px;">
  <h5 class="table-section-title">
    <i class="bi bi-table me-2"></i> Исполнители
  </h5>
</div>

<div id="performers-pane"
     hx-get="{% url 'performers_partial' %}"
     hx-trigger="load, performers-updated from:body"
     hx-target="#performers-pane"
     hx-swap="innerHTML"
     hx-indicator="#performers-loading">
  <div id="performers-loading" class="text-muted htmx-indicator">Загрузка исполнителей…</div>
</div>

<!-- Постоянная модалка «Исполнители» -->
<div class="modal fade" id="performers-modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="p-5 text-center">
        <div class="__spinner spinner-border" role="status">
          <span class="visually-hidden">Загрузка…</span>
        </div>
      </div>
    </div>
  </div>
</div>
    <script src="{% static 'core/js/performers-panels.js' %}" defer></script>
    <script>
      document.body.addEventListener('projects-updated', function () {
        const el = document.getElementById('projects-modal');
        if (!el) return;
        const modal = bootstrap.Modal.getInstance(el) || bootstrap.Modal.getOrCreateInstance(el);
        modal.hide();
      });
    </script>
    <script>
      document.body.addEventListener('htmx:afterSwap', function (e) {
        const modalContent = document.querySelector('#projects-modal .modal-content');
        if (!modalContent || !modalContent.contains(e.target)) return;

        const dlg = document.querySelector('#projects-modal .modal-dialog');
        if (!dlg) return;

        // Сбрасываем возможные размеры
        dlg.classList.remove('modal-sm','modal-lg','modal-xl','modal-fullscreen');

        // Если в загруженном фрагменте есть data-modal-size, применяем
        const sz = modalContent.querySelector('[data-modal-size]')?.dataset?.modalSize;
        if (sz === 'xl') dlg.classList.add('modal-xl');
        // можно добавить другие варианты при желании
      });
    </script>
    <script>
      document.body.addEventListener('performers-updated', function () {
        const el = document.getElementById('performers-modal');
        if (!el) return;
        const modal = bootstrap.Modal.getInstance(el) || bootstrap.Modal.getOrCreateInstance(el);
        modal.hide();
      });
    </script>
    <script>
      document.body.addEventListener('performers-updated', function () {
        const el = document.getElementById('performers-modal');
        if (!el) return;
        const modal = bootstrap.Modal.getInstance(el) || bootstrap.Modal.getOrCreateInstance(el);
        modal.hide();
      });
    </script>
  </div>
</div>